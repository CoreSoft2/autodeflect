---
- hosts: controller
  vars_files:
    - clients.yml
    - override.yml
  vars:
    bind_output: "{{playbook_dir}}/bind/"
    ats_output: "{{playbook_dir}}/ats/"
    banjax_output: "{{playbook_dir}}/banjax/"
    nagios_output: /etc/nagios3/autoconf.d/autobrains/
    tls_home: "{{playbook_dir}}/certs"
    tls_gpghome: "{{playbook_dir}}/config/gpg"
    letsencrypt_output: "{{playbook_dir}}/certs/letsencrypt"
    default_dnet: example1
    dnets:
      example1: example.local
      example2:
      example3:
    default_cache_time: 10
    le_url: "example.local:1111"
    challenger_key: thisshouldbealongsecretekey 
    botbanger_key: thisansoshouldbeareallongsecretekey
    swabber_grace: 300
    no_edit_template: 'DO NOT EDIT THIS FILE DIRECTLY. File generated by a ansible template.'
    dns_notify_servers: 
      - 127.0.0.1 
    autobrains_config:
      log_dir: /usr/local/deflect/logs/sysedits
      email_notify: monitor@example.local
      loc_bind_confs: /etc/bind
      zone_files: /etc/edgemanage/zones 
      email_key_id: sysops@example.local
      deflect_dir: /usr/local/deflect
      trafficserver_dir: /usr/local/trafficserver
      dash_proxy: example-nocacheproxy.example.local
      clients_yml_url: /brainsconfig/site.yml
      dashadmin_host: example-dashboard-admin.example.local
      dash_blacklist_url: /brainsconfig/blacklist.txt
      deploy_key_path: /usr/local/deflect/etc/edge_id 
    autobrains_bypasses:
    # Note: You must rebuild autobrains_update.sh for this
    # to take effect.
      - example.local.zone
      - example.local.config
  tags:
    - controller
  roles:
    - {role: autobrains_update}
    - {role: zonefile, tags: [zonefile, bind]}
    - {role: atsconf, tags: [ats]}
    - {role: banjax, tags: banjax}
    - {role: nagios, tags: nagios}
    - {role: lists, tags: lists}

- hosts: awstats
  vars:
    awstats_output: /etc/awstats/
    awstats_user: awremote 
  vars_files:
    - clients.yml
  user: root
  tags:
    - awstats
  roles:
    - awstats

- hosts: letsencrypt
  vars:
    letsencrypt_output: "{{playbook_dir}}/certs/letsencrypt/"
    no_edit_template: 'DO NOT EDIT THIS FILE DIRECTLY. File generated by a ansible template.'
    le_email: example@example.local
    authoritative_nameserver_grep: ns1.example.local
  vars_files:
    - clients.yml
    - override.yml
  user: root
  tags:
    - letsencrypt
  roles:
    - {role: letsencrypt, tags: letsencrypt}
