---
- hosts: controller
  vars_files:
    - clients.yml
    - override.yml
  vars:
    bind_output: "{{playbook_dir}}/bind/"
    ats_output: "{{playbook_dir}}/ats/"
    banjax_output: "{{playbook_dir}}/banjax/"
    tls_home: "{{playbook_dir}}/certs"
    tls_gpghome: "{{playbook_dir}}/config/gpg"
    letsencrypt_output: "{{playbook_dir}}/certs/letsencrypt"
    default_dnet: example1
    dnets:
      example1: example.local
      example2:
      example3:
    le_url: "example.local:1111"
    challenger_key: thisshouldbealongsecretekey 
    botbanger_key: thisansoshouldbeareallongsecretekey
    swabber_grace: 300
    dns_notify_servers: 
      - 127.0.0.1 
    timestamp_txt_record_name: alongrandomstringvalidforadnsrecord
    autobrains_config:
      log_dir: /usr/local/deflect/logs/sysedits
      email_notify: monitor@example.local
      loc_bind_confs: /etc/bind
      zone_files: /etc/edgemanage/zones 
      email_key_id: sysops@example.local
      deflect_dir: /usr/local/deflect
      trafficserver_dir: /usr/local/trafficserver
      dash_proxy: example-nocacheproxy.example.local
      clients_yml_url: /brainsconfig/site.yml
      dashadmin_host: example-dashboard-admin.example.local
      dash_blacklist_url: /brainsconfig/blacklist.txt
      deploy_key_path: /usr/local/deflect/etc/edge_id 
    autobrains_bypasses:
    # Note: You must rebuild autobrains_update.sh for this
    # to take effect.
      - example.local.zone
      - example.local.config
  tags:
    - controller
  roles:
    - {role: autobrains_update}
    - {role: zonefile, tags: [zonefile, bind]}
    - {role: atsconf, tags: ats}
    - {role: lists, tags: lists}

- hosts: letsencrypt
  vars:
    letsencrypt_output: "{{playbook_dir}}/certs/letsencrypt/"
    le_email: example@example.local
    authoritative_nameserver_grep: ns1.example.local
  vars_files:
    - clients.yml
    - override.yml
  user: root
  tags:
    - letsencrypt
  roles:
    - {role: letsencrypt, tags: letsencrypt}
